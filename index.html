<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLT35021 DAPA Assessment Timetable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Define DAPA Color Palette */
        :root {
            --dapa-primary: #532A8C; /* Deep Purple (Main Text, Accent) */
            --dapa-secondary: #C3ACE8; /* Light Purple/Lavender (Buttons, Highlights) */
            --dapa-background: #F2F2F2; /* Very Light Grey (Body Background) */
            --dapa-accent-hover: #9D8ABB; /* Muted Medium Purple (Hover State) */
            --dapa-success-bg: #E8F5E9; /* Very Light Green for completed rows */
            --dapa-success-border: #96BF78; /* Muted Light Green for completed borders */
        }
        /* Custom styles to incorporate DAPA colors via Tailwind theme */
        .bg-dapa-primary { background-color: var(--dapa-primary); }
        .text-dapa-primary { color: var(--dapa-primary); }
        .bg-dapa-secondary { background-color: var(--dapa-secondary); }
        .text-dapa-secondary { color: var(--dapa-secondary); }
        .bg-dapa-background { background-color: var(--dapa-background); }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dapa-background);
        }
        .timetable-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header-section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--dapa-primary);
        }
        .timetable-row {
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .timetable-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .completed-row {
            background-color: var(--dapa-success-bg);
            border-left: 5px solid var(--dapa-success-border);
            opacity: 0.7;
        }
        .completed-row .toggle-complete-btn {
            background-color: var(--dapa-success-border);
            color: var(--dapa-primary);
        }
        .completed-row .toggle-complete-btn:hover {
            background-color: #7AA358; /* Slightly darker green */
        }
        .toggle-complete-btn {
            background-color: var(--dapa-secondary);
            color: var(--dapa-primary);
            transition: background-color 0.2s;
        }
        .toggle-complete-btn:hover {
            background-color: var(--dapa-accent-hover);
        }
        /* Message Box Styling */
        #message-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
    </style>
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, query, orderBy, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        
        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        let userId = null;
        let unsubscribeTimetable = null;

        // --- Data from Spreadsheet (TIMETABLE_ HLT35021_V7 (DRAFT) (1).xlsx - Sheet1.csv) ---
        // This array is the source of truth for the unit and assessment descriptions.
        const UNIT_ASSESSMENT_DATA = [
            { UnitCode: 'INTRO', UnitDescription: "Let's get started!", AssessmentName: 'Task 1', AssessmentDescription: 'Introduction (Mandatory)', Weeks: '' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 1', AssessmentDescription: 'The Dental Health Team', Weeks: '1 week' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 2', AssessmentDescription: 'Ethics and Jurisprudence', Weeks: '1 week' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 3', AssessmentDescription: 'Psychology for Dental Assistants', Weeks: '0 week' },
            { UnitCode: 'CHCDIV001', UnitDescription: 'Work with diverse people', AssessmentName: 'Task 4', AssessmentDescription: 'Demonstrate understanding of diversity, culture, and inclusive practice.', Weeks: '1 week' },
            { UnitCode: 'CHCDIV001', UnitDescription: 'Work with diverse people', AssessmentName: 'Task 5', AssessmentDescription: 'Apply inclusive and respectful communication and work practices.', Weeks: '1 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate essential WHS knowledge', Weeks: '1 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 2', AssessmentDescription: 'Identify, assess, and control hazards', Weeks: '0 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 3', AssessmentDescription: 'Participate in WHS activities and follow emergency procedures', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate understanding of infection control principles', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 2', AssessmentDescription: 'Identify infection risks and select/use Personal Protective Equipment (PPE)', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 3', AssessmentDescription: 'Apply standard infection control procedures, including reprocessing reusable equipment.', Weeks: '2 weeks' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 4', AssessmentDescription: 'Final assessment for Infection Control', Weeks: '0 week' },
            { UnitCode: 'HLTAID011', UnitDescription: 'Provide First Aid', AssessmentName: 'Task 1', AssessmentDescription: 'Provide First Aid (Practical/Knowledge)', Weeks: '1 week' },
            { UnitCode: 'HLTAID011', UnitDescription: 'Provide First Aid', AssessmentName: 'Task 2', AssessmentDescription: 'First Aid in the Dental Setting', Weeks: '0 week' },
            { UnitCode: 'HLTDEN010', UnitDescription: 'Assist with dental procedures', AssessmentName: 'Task 1', AssessmentDescription: 'Dental Chairside Equipment and Preparation', Weeks: '1 week' },
            { UnitCode: 'HLTDEN010', UnitDescription: 'Assist with dental procedures', AssessmentName: 'Task 2', AssessmentDescription: 'Dental Materials (Types and Handling)', Weeks: '1 week' },
            { UnitCode: 'HLTDEN010', UnitDescription: 'Assist with dental procedures', AssessmentName: 'Task 3', AssessmentDescription: 'Assisting and Maintaining Clinical Records', Weeks: '1 week' },
            { UnitCode: 'HLTDEN010', UnitDescription: 'Assist with dental procedures', AssessmentName: 'Task 4', AssessmentDescription: 'Assisting with Simple Treatments', Weeks: '1 week' },
            { UnitCode: 'HLTDEN010', UnitDescription: 'Assist with dental procedures', AssessmentName: 'Task 5', AssessmentDescription: 'Assisting with Complex Treatments', Weeks: '1 week' },
            { UnitCode: 'HLTDEN011', UnitDescription: 'Assist with the maintenance of the dental surgery and equipment', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate knowledge of surgery and equipment maintenance.', Weeks: '1 week' },
            { UnitCode: 'HLTDEN011', UnitDescription: 'Assist with the maintenance of the dental surgery and equipment', AssessmentName: 'Task 2', AssessmentDescription: 'Maintain clinical equipment.', Weeks: '1 week' },
            { UnitCode: 'HLTDEN011', UnitDescription: 'Assist with the maintenance of the dental surgery and equipment', AssessmentName: 'Task 3', AssessmentDescription: 'Maintain non-clinical equipment and manage stock.', Weeks: '1 week' },
            { UnitCode: 'HLTDEN012', UnitDescription: 'Apply and maintain preventative dental measures', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate knowledge of preventative dental measures', Weeks: '1 week' },
            { UnitCode: 'HLTDEN012', UnitDescription: 'Apply and maintain preventative dental measures', AssessmentName: 'Task 2', AssessmentDescription: 'Assist with preventative treatments', Weeks: '1 week' },
            { UnitCode: 'HLTDEN012', UnitDescription: 'Apply and maintain preventative dental measures', AssessmentName: 'Task 3', AssessmentDescription: 'Oral Health Education with Patients', Weeks: '1 week' },
            { UnitCode: 'HLTDEN013', UnitDescription: 'Assist with practice finances', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge Questions', Weeks: '1 week' },
            { UnitCode: 'HLTDEN013', UnitDescription: 'Assist with practice finances', AssessmentName: 'Task 2', AssessmentDescription: 'Practical Groups', Weeks: '2 weeks' },
            { UnitCode: 'HLTDEN014', UnitDescription: 'Assist with the provision of oral health education programs', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge Questions', Weeks: '1 week' },
            { UnitCode: 'HLTDEN014', UnitDescription: 'Assist with the provision of oral health education programs', AssessmentName: 'Task 2', AssessmentDescription: 'Practical Groups', Weeks: '1 week' },
            { UnitCode: 'HLTDEN015', UnitDescription: 'Assist with the preparation of oral health care materials', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge Questions', Weeks: '1 week' },
            { UnitCode: 'HLTDEN015', UnitDescription: 'Assist with the preparation of oral health care materials', AssessmentName: 'Task 2', AssessmentDescription: 'Practical Groups', Weeks: '3 weeks' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate knowledge of radiation safety, equipment, and protocols', Weeks: '1 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 2', AssessmentDescription: 'Prepare the surgery, patient, and equipment for X-ray procedures', Weeks: '0 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 3', AssessmentDescription: 'Correctly process and mount conventional/digital radiographs', Weeks: '1 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 4', AssessmentDescription: 'Complete documentation and comply with quality assurance', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 1', AssessmentDescription: 'Communicate appropriately in a dental administrative setting', Weeks: '1 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 2', AssessmentDescription: 'Allocate appointments appropriate to patient and organisation requirements', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 3', AssessmentDescription: 'Process and reconcile patient accounts', Weeks: '1 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 4', AssessmentDescription: 'Maintain patient records', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 5', AssessmentDescription: 'Assist with patient recalls', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge questions', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 2', AssessmentDescription: 'Word processing', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 3', AssessmentDescription: 'Spreadsheets', Weeks: '1 week' },
            { UnitCode: 'BSBTWK201', UnitDescription: 'Work effectively with others', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge questions', Weeks: '1 week' },
            { UnitCode: 'BSBTWK201', UnitDescription: 'Work effectively with others', AssessmentName: 'Task 2', AssessmentDescription: 'Reflective journal', Weeks: '1 week' },
        ];
        
        // Firestore path helpers
        const getTimetableDocRef = (uid) => doc(db, 'artifacts', appId, 'users', uid, 'timetableData', 'progress');
        const getStudentDetailsDocRef = (uid) => doc(db, 'artifacts', appId, 'users', uid, 'studentDetails', 'info');

        // State variables
        let studentDetails = { name: '', number: '', courseDates: '' };
        let studentProgress = {}; // Stores { 'UnitCode-AssessmentName': boolean }

        // Utility to show messages
        const showMessage = (message, isError = false) => {
            const box = document.getElementById('message-box');
            box.innerHTML = `
                <div class="p-3 mb-2 rounded-lg text-sm font-semibold shadow-lg ${isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">
                    ${message}
                </div>
            `;
            setTimeout(() => { box.innerHTML = ''; }, 3000);
        };

        // --- Firebase Functions ---
        
        async function loadStudentDetails() {
            if (!userId || !db) return;

            // 1. Load Student Info
            try {
                const docSnap = await getDoc(getStudentDetailsDocRef(userId));
                if (docSnap.exists()) {
                    studentDetails = docSnap.data();
                    document.getElementById('student-name').value = studentDetails.name || '';
                    document.getElementById('student-number').value = studentDetails.number || '';
                    document.getElementById('course-dates').value = studentDetails.courseDates || '';
                } else {
                    console.log("No student details found. Using defaults/empty.");
                }
            } catch (e) {
                console.error("Error loading student details:", e);
                showMessage("Failed to load student details.", true);
            }

            // 2. Load Timetable Progress (Realtime listener)
            if (unsubscribeTimetable) {
                unsubscribeTimetable(); // Clean up previous listener if it exists
            }
            unsubscribeTimetable = onSnapshot(getTimetableDocRef(userId), (docSnap) => {
                if (docSnap.exists()) {
                    studentProgress = docSnap.data() || {};
                    console.log("Timetable progress updated from Firestore:", studentProgress);
                } else {
                    studentProgress = {};
                    console.log("No timetable progress found. Initializing empty progress.");
                }
                // Always re-render the timetable on progress change
                renderTimetable(UNIT_ASSESSMENT_DATA, studentProgress);
            }, (error) => {
                console.error("Error setting up timetable progress listener:", error);
                showMessage("Failed to set up real-time progress updates.", true);
            });
        }

        async function saveStudentDetails(e) {
            e.preventDefault();
            if (!userId || !db) { showMessage("Not authenticated. Cannot save.", true); return; }

            const newDetails = {
                name: document.getElementById('student-name').value.trim(),
                number: document.getElementById('student-number').value.trim(),
                courseDates: document.getElementById('course-dates').value.trim(),
            };
            
            try {
                await setDoc(getStudentDetailsDocRef(userId), newDetails, { merge: true });
                studentDetails = newDetails;
                showMessage("Student details saved successfully!");
            } catch (e) {
                console.error("Error saving student details:", e);
                showMessage("Failed to save student details.", true);
            }
        }
        
        window.toggleAssessmentCompletion = async (unitCode, assessmentName) => {
            if (!userId || !db) { showMessage("Not authenticated. Cannot update progress.", true); return; }

            const key = `${unitCode}-${assessmentName}`;
            const isCompleted = studentProgress[key] || false;
            
            // Prepare update object
            const update = {
                [key]: !isCompleted
            };

            try {
                // Set the specific key within the progress document
                await setDoc(getTimetableDocRef(userId), update, { merge: true });
                // Note: The onSnapshot listener will handle the local update and re-render.
                showMessage(`${unitCode} - ${assessmentName} marked as ${!isCompleted ? 'Complete' : 'Pending'}.`);
            } catch (e) {
                console.error("Error updating assessment progress:", e);
                showMessage("Failed to update assessment progress.", true);
            }
        }

        // --- Rendering Function ---

        function renderTimetable(data, progress) {
            const container = document.getElementById('timetable-body');
            if (!container) return;

            let html = '';
            let currentUnitCode = null;
            let totalTasks = data.length;
            let completedTasks = 0;

            data.forEach((item) => {
                const key = `${item.UnitCode}-${item.AssessmentName}`;
                const isCompleted = progress[key] === true;
                
                if (isCompleted) {
                    completedTasks++;
                }

                // Start of a new unit group
                if (item.UnitCode !== currentUnitCode) {
                    currentUnitCode = item.UnitCode;
                    const unitDescription = item.UnitCode === 'INTRO' ? 'Introduction' : item.UnitDescription;
                    html += `
                        <tr class="bg-gray-100 font-bold text-dapa-primary">
                            <td colspan="5" class="px-4 py-2 border-t-4 border-dapa-primary rounded-t-lg">
                                ${item.UnitCode === 'INTRO' ? item.UnitDescription : item.UnitCode + ' - ' + item.UnitDescription}
                            </td>
                        </tr>
                    `;
                }

                // Assessment Row
                html += `
                    <tr class="timetable-row border-b border-gray-200 ${isCompleted ? 'completed-row' : 'bg-white'}" data-unit-code="${item.UnitCode}" data-assessment-name="${item.AssessmentName}">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.UnitCode === 'INTRO' ? '' : item.UnitCode}</td>
                        <td class="px-4 py-3 text-sm text-gray-700 max-w-xs">${item.UnitDescription}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${item.AssessmentName}</td>
                        <td class="px-4 py-3 text-sm text-gray-700 max-w-md">${item.AssessmentDescription}</td>
                        <td class="px-4 py-3 text-center text-sm font-semibold text-dapa-primary">${item.Weeks}</td>
                        <td class="px-4 py-3 text-center">
                            <button 
                                onclick="toggleAssessmentCompletion('${item.UnitCode}', '${item.AssessmentName}')"
                                class="toggle-complete-btn px-3 py-1 text-xs font-bold rounded-full hover:shadow-lg transition duration-150"
                                title="Mark as ${isCompleted ? 'Pending' : 'Complete'}"
                            >
                                ${isCompleted ? 'âœ“ Completed' : 'Mark Complete'}
                            </button>
                        </td>
                    </tr>
                `;
            });

            container.innerHTML = html;
            updateProgressSummary(totalTasks, completedTasks);
        }

        function updateProgressSummary(total, completed) {
            const percentage = total > 0 ? ((completed / total) * 100).toFixed(0) : 0;
            const progressRing = document.getElementById('progress-ring');
            const progressText = document.getElementById('progress-text');
            const circumference = 2 * Math.PI * 45; // 2 * PI * r (r=45)

            if (progressRing) {
                progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
                progressRing.style.strokeDashoffset = circumference - (percentage / 100) * circumference;
            }
            if (progressText) {
                progressText.innerHTML = `<span class="text-3xl font-bold">${percentage}%</span><span class="block text-sm">(${completed}/${total} Tasks)</span>`;
            }
        }


        // --- Initialization ---

        function initFirebaseAndAuth() {
            setLogLevel('debug'); // Enable detailed Firebase logging
            
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing.");
                showMessage("Firebase setup error: Configuration missing.", true);
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Set persistence to local storage
                setPersistence(auth, browserLocalPersistence)
                    .catch(error => {
                        console.error("Failed to set persistence:", error.code, error.message);
                    });

                // Initial sign-in attempt
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken)
                        .catch(error => {
                            console.error("Custom token sign-in failed. Falling back to anonymous.", error);
                            return signInAnonymously(auth);
                        });
                } else {
                    signInAnonymously(auth).catch(error => {
                        console.error("Anonymous sign-in failed.", error);
                    });
                }

                // Auth state listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated with userId:", userId);
                        
                        // Proceed to check for saved data
                        loadStudentDetails();
                    } else {
                        userId = null;
                        console.log("No user signed in. Waiting for sign-in.");
                        // Render timetable with base data but without progress (or clear progress)
                        renderTimetable(UNIT_ASSESSMENT_DATA, {}); 
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showMessage("Firebase setup error. Check console.", true);
                renderTimetable(UNIT_ASSESSMENT_DATA, {}); // Show base data even if auth fails
            }
        }

        // Start the application flow
        window.onload = initFirebaseAndAuth;

    </script>
</head>
<body class="bg-dapa-background p-4 sm:p-8">

    <!-- Message Box -->
    <div id="message-box"></div>

    <div class="timetable-container">
        
        <!-- Header and Progress Summary -->
        <div class="header-section mb-6">
            <h1 class="text-3xl font-extrabold text-dapa-primary mb-1">HLT35021 Dental Assisting Timetable</h1>
            <p class="text-gray-600 mb-6">Track your progress for the Certificate III in Dental Assisting written assessments.</p>

            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                <!-- Student Details Form -->
                <form id="student-details-form" class="w-full md:w-3/4 grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="student-name" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Student Name</label>
                        <input type="text" id="student-name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition" placeholder="Jane Doe">
                    </div>
                    <div>
                        <label for="student-number" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Student Number</label>
                        <input type="text" id="student-number" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition" placeholder="S1234567">
                    </div>
                    <div>
                        <label for="course-dates" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Course Dates</label>
                        <input type="text" id="course-dates" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition" placeholder="Jan 2024 - Dec 2024">
                    </div>
                    <div class="sm:col-span-3 pt-2">
                         <button type="submit" onclick="saveStudentDetails(event)" class="bg-dapa-primary text-white px-5 py-2 rounded-lg text-sm font-semibold hover:bg-dapa-accent-hover transition duration-300">
                            Save Details
                        </button>
                    </div>
                </form>

                <!-- Progress Ring -->
                <div class="md:w-1/4 flex justify-center md:justify-end">
                    <div class="relative w-24 h-24">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <!-- Background circle -->
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#E0E0E0" stroke-width="10"></circle>
                            <!-- Progress circle -->
                            <circle id="progress-ring" cx="50" cy="50" r="45" fill="none" stroke="var(--dapa-primary)" stroke-width="10" stroke-linecap="round" style="transition: stroke-dashoffset 0.5s ease;"></circle>
                        </svg>
                        <div id="progress-text" class="absolute inset-0 flex flex-col items-center justify-center text-dapa-primary">
                            <span class="text-3xl font-bold">0%</span>
                            <span class="block text-sm">(0/45 Tasks)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Timetable Table -->
        <div class="shadow-xl rounded-lg overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-dapa-primary text-white">
                    <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-1/12">Unit Code</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-3/12">Unit Description</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-1/12">Assessment</th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-5/12">Assessment Description</th>
                        <th scope="col" class="px-4 py-3 text-center text-xs font-bold uppercase tracking-wider w-1/12">Weeks</th>
                        <th scope="col" class="px-4 py-3 text-center text-xs font-bold uppercase tracking-wider w-1/12">Status</th>
                    </tr>
                </thead>
                <tbody id="timetable-body" class="bg-white divide-y divide-gray-200">
                    <!-- Timetable rows will be rendered here by JavaScript -->
                    <tr>
                        <td colspan="6" class="p-8 text-center text-gray-500">Loading Timetable Data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <p class="text-center text-xs text-gray-400 mt-4">User ID: <span id="display-user-id">Loading...</span></p>

    </div>
    <script>
        // Update user ID display once available
        window.addEventListener('load', () => {
            const userIdInterval = setInterval(() => {
                const userIdElement = document.getElementById('display-user-id');
                if (typeof userId !== 'undefined' && userIdElement) {
                    userIdElement.textContent = userId || 'Anonymous/Not Signed In';
                    clearInterval(userIdInterval);
                }
            }, 100);
        });
    </script>
</body>
</html>
