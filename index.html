<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLT35021 DAPA Assessment Timetable</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Define DAPA Color Palette */
        :root {
            --dapa-primary: #532A8C; /* Deep Purple (Main Text, Accent) */
            --dapa-secondary: #C3ACE8; /* Light Purple/Lavender (Buttons, Highlights) */
            --dapa-background: #F2F2F2; /* Very Light Grey (Body Background) */
            --dapa-accent-hover: #9D8ABB; /* Muted Medium Purple (Hover State) */
        }
        /* Custom styles to incorporate DAPA colors via Tailwind theme */
        .bg-dapa-primary { background-color: var(--dapa-primary); }
        .text-dapa-primary { color: var(--dapa-primary); }
        .bg-dapa-secondary { background-color: var(--dapa-secondary); }
        .text-dapa-secondary { color: var(--dapa-secondary); }
        .bg-dapa-background { background-color: var(--dapa-background); }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dapa-background);
        }
        .timetable-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header-section {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border-top: 5px solid var(--dapa-primary);
        }
        /* Row animations and styling */
        .timetable-row {
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .timetable-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        /* Message Box Styling */
        #message-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
    </style>
    <!-- Firebase Libraries -->
    <script type="module">
        // Import necessary Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
        
        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        let userId = null;

        // --- Data Source for Assessments ---
        // This array holds the static timetable structure.
        const UNIT_ASSESSMENT_DATA = [
            { UnitCode: 'INTRO', UnitDescription: "Let's get started!", AssessmentName: 'Task 1', AssessmentDescription: 'Introduction (Mandatory)', Weeks: '0 week' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 1', AssessmentDescription: 'The Dental Health Team', Weeks: '1 week' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 2', AssessmentDescription: 'Ethics and Jurisprudence', Weeks: '1 week' },
            { UnitCode: 'CHCCOM005', UnitDescription: 'Communicate and work in health or community service', AssessmentName: 'Task 3', AssessmentDescription: 'Psychology for Dental Assistants', Weeks: '0 week' },
            { UnitCode: 'CHCDIV001', UnitDescription: 'Work with diverse people', AssessmentName: 'Task 4', AssessmentDescription: 'Demonstrate understanding of diversity, culture, and inclusive practice.', Weeks: '1 week' },
            { UnitCode: 'CHCDIV001', UnitDescription: 'Work with diverse people', AssessmentName: 'Task 5', AssessmentDescription: 'Apply inclusive and respectful communication and work practices.', Weeks: '1 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate essential WHS knowledge', Weeks: '1 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 2', AssessmentDescription: 'Identify, assess, and control hazards', Weeks: '0 week' },
            { UnitCode: 'HLTWHS001', UnitDescription: 'Participate in workplace health and safety', AssessmentName: 'Task 3', AssessmentDescription: 'Participate in WHS activities and follow emergency procedures', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate understanding of infection control principles', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 2', AssessmentDescription: 'Identify infection risks and select/use Personal Protective Equipment (PPE)', Weeks: '1 week' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply standard principles and practices of infection prevention and control', AssessmentName: 'Task 3', AssessmentDescription: 'Apply standard infection control procedures, including reprocessing reusable equipment.', Weeks: '2 weeks' },
            { UnitCode: 'HLTINF006', UnitDescription: 'Apply basic principles and practices of infection prevention and control', AssessmentName: 'Task 4', AssessmentDescription: 'Final assessment for Infection Control', Weeks: '0 week' },
            
            // --- HLTINF002 ---
            { UnitCode: 'HLTINF002', UnitDescription: 'Process reusable instruments and equipment in health work', AssessmentName: 'Task 5', AssessmentDescription: 'Drying, Inspection, and Packaging', Weeks: '1 week' },
            { UnitCode: 'HLTINF002', UnitDescription: 'Process reusable instruments and equipment in health work', AssessmentName: 'Task 6', AssessmentDescription: 'Operating the Steriliser (Autoclave)', Weeks: '0 week' },
            // --- END HLTINF002 ---
            
            // HLTDEN010, HLTDEN011, HLTDEN012, HLTDEN013, HLTDEN014 REMOVED as per user request.

            { UnitCode: 'HLTDEN015', UnitDescription: 'Prepare for and assist with dental procedures', AssessmentName: 'Workbook 1', AssessmentDescription: 'Foundational Clinic & Communication', Weeks: '5 weeks' },
            { UnitCode: 'HLTDEN015', UnitDescription: 'Prepare for and assist with dental procedures', AssessmentName: 'Workbook 2', AssessmentDescription: 'Clinical Assistance & Logistics', Weeks: '3 weeks' },
            { UnitCode: 'HLTDEN015', UnitDescription: 'Prepare for and assist with dental procedures', AssessmentName: 'Workbook 3', AssessmentDescription: 'Theoretical Knowledge (Anatomy, Pathology, Pharmacology)', Weeks: '3 weeks' },
            { UnitCode: 'HLTDEN015', UnitDescription: 'Prepare for and assist with dental procedures', AssessmentName: 'Workbook 4', AssessmentDescription: 'Specialised Fields & Patient Groups', Weeks: '3 weeks' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 1', AssessmentDescription: 'Demonstrate knowledge of radiation safety, equipment, and protocols', Weeks: '1 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 2', AssessmentDescription: 'Prepare the surgery, patient, and equipment for X-ray procedures', Weeks: '0 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 3', AssessmentDescription: 'Correctly process and mount conventional/digital radiographs', Weeks: '1 week' },
            { UnitCode: 'HLTDEN016', UnitDescription: 'Assist with dental radiography', AssessmentName: 'Task 4', AssessmentDescription: 'Complete documentation and comply with quality assurance', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 1', AssessmentDescription: 'Communicate appropriately in a dental administrative setting', Weeks: '1 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 2', AssessmentDescription: 'Allocate appointments appropriate to patient and organisation requirements', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 3', AssessmentDescription: 'Process and reconcile patient accounts', Weeks: '1 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with administration in dental practice', AssessmentName: 'Task 4', AssessmentDescription: 'Maintain patient records', Weeks: '0 week' },
            { UnitCode: 'HLTDEN017', UnitDescription: 'Assist with patient recalls', AssessmentName: 'Task 5', AssessmentDescription: 'Assist with patient recalls', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge questions', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 2', AssessmentDescription: 'Word processing', Weeks: '1 week' },
            { UnitCode: 'BSBTEC201', UnitDescription: 'Use business software applications', AssessmentName: 'Task 3', AssessmentDescription: 'Spreadsheets', Weeks: '1 week' },
            { UnitCode: 'BSBTWK201', UnitDescription: 'Work effectively with others', AssessmentName: 'Task 1', AssessmentDescription: 'Knowledge questions', Weeks: '1 week' },
            { UnitCode: 'BSBTWK201', UnitDescription: 'Work effectively with others', AssessmentName: 'Task 2', AssessmentName: 'Reflective journal', Weeks: '1 week' },
            
            // HLTAID011 MOVED TO END
            { UnitCode: 'HLTAID011', UnitDescription: 'Provide First Aid', AssessmentName: 'Task 1', AssessmentDescription: 'Provide First Aid (Practical/Knowledge)', Weeks: '1 week' },
            { UnitCode: 'HLTAID011', UnitDescription: 'Provide First Aid', AssessmentName: 'Task 2', AssessmentDescription: 'First Aid in the Dental Setting', Weeks: '0 week' },
        ];

        // --- Representative Public Holidays (NSW 2026 - YYYY-MM-DD) ---
        // Submission dates will be moved to the next business day if they fall on one of these dates.
        const PUBLIC_HOLIDAYS = [
            "2026-01-01", // New Year's Day
            "2026-01-26", // Australia Day
            "2026-04-03", // Good Friday
            "2026-04-04", // Easter Saturday
            "2026-04-05", // Easter Sunday
            "2026-04-06", // Easter Monday
            "2026-04-27", // Anzac Day (Observed Monday)
            "2026-06-08", // King's Birthday
            "2026-10-05", // Labour Day
            "2026-12-25", // Christmas Day
            "2026-12-28", // Boxing Day (Observed Monday)
        ];
        
        // Firestore path helper for student details
        const getStudentDetailsDocRef = (uid) => doc(db, 'artifacts', appId, 'users', uid, 'studentDetails', 'info');

        // State variables
        let studentDetails = { name: '', number: '', startDate: '' }; 

        // Utility to show temporary, custom messages (instead of alert())
        const showMessage = (message, isError = false) => {
            const box = document.getElementById('message-box');
            box.innerHTML = `
                <div class="p-3 mb-2 rounded-lg text-sm font-semibold shadow-lg ${isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">
                    ${message}
                </div>
            `;
            setTimeout(() => { box.innerHTML = ''; }, 3000);
        };

        // --- Date Calculation Helper ---

        /**
         * Checks if a date falls on a weekend (Saturday or Sunday).
         * @param {Date} date - The Date object to check.
         * @returns {boolean} True if it's a weekend, false otherwise.
         */
        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6; // Sunday (0) or Saturday (6)
        }

        /**
         * Checks if a date falls on a representative public holiday.
         * Note: This list is fixed and representative for demonstration purposes.
         * @param {Date} date - The Date object to check.
         * @returns {boolean} True if it's a holiday, false otherwise.
         */
        function isHoliday(date) {
            // Format the date as YYYY-MM-DD for comparison
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            return PUBLIC_HOLIDAYS.includes(dateStr);
        }

        /**
         * Finds the next valid working day (Monday to Friday, non-holiday).
         * Advances the date if it falls on a weekend or a representative public holiday.
         * @param {Date} date - The calculated date.
         * @returns {Date} The next valid working date.
         */
        function getNextValidDate(date) {
            const validDate = new Date(date); // Work with a copy

            // Keep adding a day until it's a weekday and not a holiday
            while (isWeekend(validDate) || isHoliday(validDate)) {
                // Add one day to the current date
                validDate.setDate(validDate.getDate() + 1);
            }
            return validDate;
        }


        /**
         * Adds a specified number of weeks to a base Date object, then adjusts the date 
         * to the next available weekday (not a weekend or holiday).
         * @param {Date} baseDate - The Date object to start from.
         * @param {string} weeksStr - The duration string (e.g., "1 week", "2 weeks", "0 week").
         * @returns {Date} The new Date object after adding the weeks and adjustment.
         */
        function addWeeksToDate(baseDate, weeksStr) {
            // Parse weeks from string (e.g., "1 week", "2 weeks", "0 week")
            const match = weeksStr.match(/(\d+)/);
            const weeks = match ? parseInt(match[1], 10) : 0;

            // Calculate milliseconds for N weeks: weeks * 7 days/week * ...
            const msInWeek = 7 * 24 * 60 * 60 * 1000;
            
            // Create a new Date object and add weeks (raw calculation)
            const rawDate = new Date(baseDate.getTime() + (weeks * msInWeek));
            
            // Adjust the date to the next valid working day
            return getNextValidDate(rawDate);
        }

        /**
         * Formats a Date object to DD/MM/YYYY string.
         * @param {Date} dateObj - The Date object to format.
         * @returns {string} Formatted date (DD/MM/YYYY).
         */
        function formatDate(dateObj) {
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
            const year = dateObj.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // --- Firebase Functions ---
        
        // Load student details and render the timetable
        async function loadStudentDetails() {
            if (!userId || !db) return;

            try {
                const docSnap = await getDoc(getStudentDetailsDocRef(userId));
                if (docSnap.exists()) {
                    studentDetails = docSnap.data();
                    // Update form fields with loaded data
                    document.getElementById('student-name').value = studentDetails.name || '';
                    document.getElementById('student-number').value = studentDetails.number || '';
                    document.getElementById('course-start-date').value = studentDetails.startDate || ''; 
                } else {
                    console.log("No student details found. Using defaults/empty.");
                }
                // Always render the timetable after trying to load details
                renderTimetable(UNIT_ASSESSMENT_DATA); 

            } catch (e) {
                console.error("Error loading student details:", e);
                showMessage("Failed to load student details.", true);
                renderTimetable(UNIT_ASSESSMENT_DATA); // Render default table on error
            }
        }

        // Save student details (Name, Number, Start Date) to Firestore
        async function handleSaveDetails(e) {
            e.preventDefault();
            if (!userId || !db) { 
                showMessage("Not authenticated. Cannot save."); 
                return;
            }

            const newDetails = {
                name: document.getElementById('student-name').value.trim(),
                number: document.getElementById('student-number').value.trim(),
                startDate: document.getElementById('course-start-date').value.trim(), 
            };
            
            try {
                await setDoc(getStudentDetailsDocRef(userId), newDetails, { merge: true });
                studentDetails = newDetails;
                // Re-render immediately to update calculated dates
                renderTimetable(UNIT_ASSESSMENT_DATA);
                showMessage("Student details saved successfully!");
            } catch (e) {
                console.error("Error saving student details:", e);
                showMessage("Failed to save student details.", true);
            }
        }

        // --- Rendering Function ---

        function renderTimetable(data) {
            const container = document.getElementById('timetable-body');
            if (!container) return;

            let html = '';
            let currentUnitCode = null;
            const startDateStr = studentDetails.startDate; // Get the start date string

            // Guard clause for missing start date
            if (!startDateStr) {
                // Changed colspan to 4
                container.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-red-500 font-semibold">Please enter a Course Start Date and click "Save Details" to generate the cumulative schedule.</td></tr>';
                return;
            }
            
            // Initialize the rolling completion date (start date)
            let currentCompletionDate = new Date(startDateStr);
            // Fix for timezone offset issue: setting the time to noon on the start date
            currentCompletionDate.setHours(12, 0, 0, 0); 
            
            if (isNaN(currentCompletionDate.getTime())) {
                // Changed colspan to 4
                container.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-red-500 font-semibold">Invalid Course Start Date. Please correct the date input.</td></tr>';
                return;
            }

            // Adjust the start date itself if it's a weekend/holiday
            currentCompletionDate = getNextValidDate(currentCompletionDate);

            data.forEach((item) => {
                
                // 1. Calculate the *next* cumulative completion date by adding the current item's weeks.
                // The addWeeksToDate function now handles the weekend/holiday adjustment internally.
                currentCompletionDate = addWeeksToDate(currentCompletionDate, item.Weeks);
                
                // 2. Format the date display. All non-error dates are consistently bold.
                const dateDisplay = formatDate(currentCompletionDate);

                // Start of a new unit group header row
                if (item.UnitCode !== currentUnitCode) {
                    currentUnitCode = item.UnitCode;
                    html += `
                        <tr class="bg-gray-100 font-bold text-dapa-primary">
                            <!-- colspan changed from 5 to 4 -->
                            <td colspan="4" class="px-4 py-2 border-t-4 border-dapa-primary">
                                ${item.UnitCode === 'INTRO' ? item.UnitDescription : item.UnitCode + ' - ' + item.UnitDescription}
                            </td>
                        </tr>
                    `;
                }

                // Assessment Row
                html += `
                    <tr class="timetable-row border-b border-gray-200 bg-white" data-unit-code="${item.UnitCode}" data-assessment-name="${item.AssessmentName}">
                        <!-- Unit Code (w-1/12) -->
                        <td class="px-4 py-3 text-sm font-medium text-gray-900 w-1/12">${item.UnitCode === 'INTRO' ? '' : item.UnitCode}</td>
                        <!-- Unit Description column REMOVED -->
                        <!-- Assessment (w-1/12) -->
                        <td class="px-4 py-3 text-sm text-gray-700 w-1/12">${item.AssessmentName}</td>
                        <!-- Assessment Description (w-4/12 + w-3/12 = w-7/12) -->
                        <td class="px-4 py-3 text-sm text-gray-700 max-w-md w-7/12">${item.AssessmentDescription}</td>
                        <!-- Submission Date (w-3/12) -->
                        <td class="px-4 py-3 text-center text-sm text-dapa-primary font-bold w-3/12">
                            ${dateDisplay}
                        </td>
                    </tr>
                `;
            });

            container.innerHTML = html;
        }


        // --- Initialization ---

        function initFirebaseAndAuth() {
            setLogLevel('debug'); // Enable detailed Firebase logging
            
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is missing.");
                showMessage("Firebase setup error: Configuration missing.", true);
                renderTimetable(UNIT_ASSESSMENT_DATA); 
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                setPersistence(auth, browserLocalPersistence)
                    .catch(error => {
                        console.error("Failed to set persistence:", error.code, error.message);
                    });

                const signInProcedure = async () => {
                    if (initialAuthToken) {
                        return signInWithCustomToken(auth, initialAuthToken)
                            .catch(error => {
                                console.error("Custom token sign-in failed. Falling back to anonymous.", error);
                                return signInAnonymously(auth);
                            });
                    } else {
                        return signInAnonymously(auth).catch(error => {
                            console.error("Anonymous sign-in failed.", error);
                        });
                    }
                };

                // Auth state listener: runs when auth state changes (sign-in/out)
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated with userId:", userId);
                        document.getElementById('display-user-id').textContent = userId;
                        // Once authenticated, load data
                        loadStudentDetails();
                    } else {
                        userId = null;
                        console.log("No user signed in. Waiting for sign-in.");
                        document.getElementById('display-user-id').textContent = 'Anonymous/Not Signed In';
                        renderTimetable(UNIT_ASSESSMENT_DATA); 
                    }
                });
                
                signInProcedure();
                
                // Attach event listener for the form submission
                const form = document.getElementById('student-details-form');
                if (form) {
                    form.addEventListener('submit', handleSaveDetails);
                } else {
                    console.error("Form element 'student-details-form' not found.");
                }

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showMessage("Firebase setup error. Check console.", true);
                renderTimetable(UNIT_ASSESSMENT_DATA); 
            }
        }

        // Start the application flow on window load
        window.onload = initFirebaseAndAuth;

    </script>
</head>
<body class="bg-dapa-background p-4 sm:p-8">

    <!-- Message Box for feedback (instead of alerts) -->
    <div id="message-box"></div>

    <div class="timetable-container">
        
        <!-- Header Section -->
        <div class="header-section mb-6">
            <h1 class="text-3xl font-extrabold text-dapa-primary mb-1">HLT35021 Dental Assisting Timetable</h1>
            <!-- Updated description text -->
            <p class="text-gray-600 mb-2">Review your estimated submission schedule below based on your course start date.</p>
            <p class="text-sm text-gray-500 italic border-l-4 border-yellow-500 pl-3 py-1 bg-yellow-50 rounded-md">
                Submission dates automatically adjust to the next business day if they fall on a weekend or a public holiday. 
                (The public holiday list is a fixed, representative sample for demonstration purposes).
            </p>

            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mt-4">
                <!-- Student Details Form (now full width) -->
                <form id="student-details-form" class="w-full grid grid-cols-1 sm:grid-cols-4 gap-4">
                    <div class="sm:col-span-1">
                        <label for="student-name" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Student Name</label>
                        <input type="text" id="student-name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition" placeholder="Jane Doe">
                    </div>
                    <div class="sm:col-span-1">
                        <label for="student-number" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Student Number</label>
                        <input type="text" id="student-number" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition" placeholder="S1234567">
                    </div>
                    <div class="sm:col-span-1">
                        <label for="course-start-date" class="block text-xs font-semibold uppercase text-gray-500 mb-1">Course Start Date</label>
                        <input type="date" id="course-start-date" class="w-full p-2 border border-gray-300 rounded-md focus:ring-dapa-primary focus:border-dapa-primary transition">
                    </div>
                    <div class="sm:col-span-1 pt-2 flex items-end">
                         <!-- Removed onclick attribute and will handle submission via event listener on the form element -->
                         <button type="submit" class="bg-dapa-primary text-white px-5 py-2 rounded-lg text-sm font-semibold hover:bg-dapa-accent-hover transition duration-300 w-full">
                            Save Details & Calculate Dates
                        </button>
                    </div>
                </form>

            </div>
        </div>
        
        <!-- Timetable Table -->
        <div class="shadow-xl rounded-lg overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-dapa-primary text-white">
                    <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-1/12">Unit Code</th>
                        <!-- Unit Description column REMOVED -->
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-1/12">Assessment</th>
                        <!-- Width adjusted from w-4/12 to w-7/12 -->
                        <th scope="col" class="px-4 py-3 text-left text-xs font-bold uppercase tracking-wider w-7/12">Assessment Description</th>
                        <th scope="col" class="px-4 py-3 text-center text-xs font-bold uppercase tracking-wider w-3/12">Submission Date</th>
                    </tr>
                </thead>
                <tbody id="timetable-body" class="bg-white divide-y divide-gray-200">
                    <!-- Timetable rows will be rendered here by JavaScript -->
                    <!-- Updated colspan for loading row -->
                    <tr>
                        <td colspan="4" class="p-8 text-center text-gray-500">Loading Timetable Data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <p class="text-center text-xs text-gray-400 mt-4">
            User ID: <span id="display-user-id">Loading...</span>
        </p>

    </div>
</body>
</html>
